{% extends 'base.html' %}

{% block title %}뇌사XMatch알리미 - 근무자 관리{% endblock %}

{% block head %}
    {{ super() }}
    <!-- workers.html에만 필요한 스타일 -->
    <style>
        /* 이 스타일은 static/css/style.css 파일로 옮기는 것을 권장합니다. */
        h2 {
            color: #333;
            margin-top: 25px;
            margin-bottom: 15px;
            text-align: center; /* 제목 중앙 정렬 */
        }
        form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center; /* 폼 중앙 정렬 */
        }
        form input[type="text"] {
            flex-grow: 0; /* flex-grow 제거 */
            width: 200px; /* 고정 너비 설정 또는 max-width 사용 */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        form button[type="submit"] {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        form button[type="submit"]:hover {
            background-color: #0056b3;
        }
        #worker-list {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 10px;
            background-color: #fcfcfc;
            max-width: 600px; /* 리스트 너비 제한 */
            margin: 20px auto; /* 중앙 정렬 */
        }
        .worker-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fff;
            margin-bottom: 8px;
            padding: 12px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: grab; /* 드래그 가능함을 나타냄 */
            transition: background-color 0.2s ease;
        }
        .worker-item:hover {
            background-color: #f9f9f9;
        }
        .worker-item.off-duty {
            background-color: #ffe0b2; /* OFF 상태 배경색 */
            border-left: 5px solid #ff9800; /* OFF 상태 강조 */
            color: #555;
        }
        /* 근무자 이름과 마지막 근무일을 감싸는 span */
        .worker-item .worker-name-and-details { /* 클래스 이름 변경 */
            flex-grow: 1; /* 남은 공간을 차지하도록 */
            text-align: left;
            display: flex; /* 이름과 날짜를 한 줄에 표시하기 위해 flex 사용 */
            align-items: baseline; /* 텍스트 베이스라인 정렬 */
            flex-wrap: wrap; /* 공간 부족 시 줄바꿈 허용 */
        }
        .worker-name {
            font-weight: bold;
            margin-right: 5px; /* 이름과 날짜 사이 간격 */
        }
        .worker-details {
            font-size: 0.9em;
            color: #666;
            white-space: nowrap; /* 날짜가 줄바꿈되지 않도록 */
        }
        /* 버튼들을 감싸는 span */
        .worker-item .worker-actions {
            flex-shrink: 0; /* 공간이 줄어들지 않도록 */
            display: flex;
            gap: 10px; /* 버튼들 사이 간격 */
            align-items: center;
        }
        .worker-item button, .worker-item a {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9em;
            transition: background-color 0.2s ease;
            white-space: nowrap; /* 버튼 텍스트 줄바꿈 방지 */
        }
        .toggle-off-btn {
            background-color: #17a2b8; /* 정보성 색상 */
            color: white;
        }
        .toggle-off-btn:hover {
            background-color: #138496;
        }
        .worker-item a {
            background-color: #dc3545; /* 위험 색상 */
            color: white;
        }
        .worker-item a:hover {
            background-color: #c82333;
        }
        .back-to-main {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .back-to-main:hover {
            background-color: #5a6268;
        }
    </style>
{% endblock %}

{% block content %}
    <h1>근무자 관리</h1>

    <h2>새 근무자 추가</h2>
    <form action="{{ url_for('workers') }}" method="POST">
        <input type="text" name="name" placeholder="근무자 이름" required>
        <button type="submit">추가</button>
    </form>

    <h2>현재 근무자 목록 (드래그 앤 드롭으로 순서 변경 가능)</h2>
    {% if workers %}
        <ul id="worker-list">
            {% for worker in workers %}
                <li data-id="{{ worker.id }}" class="worker-item {% if worker.is_off %}off-duty{% endif %}">
                    <span class="worker-name-and-details">
                        <span class="worker-name">{{ worker.name }}</span>
                        {% if worker.is_off %} <span class="worker-details">(OFF)</span> {% endif %}
                        <!-- 마지막 근무일 표시 -->
                        <span class="worker-details">
                            (마지막 근무일: {{ worker.last_duty_date | default('없음') }})
                        </span>
                    </span>
                    <span class="worker-actions">
                        <button class="toggle-off-btn" data-id="{{ worker.id }}" data-is-off="{{ worker.is_off | tojson }}">
                            {% if worker.is_off %} OFF 해제 {% else %} OFF 설정 {% endif %}
                        </button>
                        <!-- IMPORTANT: For production, replace this 'confirm' with a custom modal UI. -->
                        <a href="{{ url_for('delete_worker', worker_id=worker.id) }}"
                           onclick="return confirm('{{ worker.name }} 님을 삭제하시겠습니까?');">
                            [삭제]
                        </a>
                    </span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>등록된 근무자가 없습니다.</p>
    {% endif %}

    <p><a href="{{ url_for('index') }}" class="back-to-main">메인 페이지로 돌아가기</a></p>

    <!-- SortableJS 라이브러리 (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <!-- 커스텀 JavaScript 파일 -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}
